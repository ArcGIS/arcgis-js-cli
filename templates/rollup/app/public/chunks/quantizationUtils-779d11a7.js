import{bq as t,br as n,bs as i,A as e,bt as r,bu as a,bv as s,bw as o,bx as h,aH as l,ao as u,am as c,b1 as m,aC as f}from"../main.js";import{t as x}from"./json-9a5f5790.js";import{r as p}from"./quickselect-efd045df.js";const d=[0,0];function g(t,n){if(!n)return null;if("x"in n){const i={x:0,y:0};return[i.x,i.y]=t(n.x,n.y,d),null!=n.z&&(i.z=n.z),null!=n.m&&(i.m=n.m),i}if("xmin"in n){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(n.xmin,n.ymin,d),[i.xmax,i.ymax]=t(n.xmax,n.ymax,d),n.hasZ&&(i.zmin=n.zmin,i.zmax=n.zmax,i.hasZ=!0),n.hasM&&(i.mmin=n.mmin,i.mmax=n.mmax,i.hasM=!0),i}return"rings"in n?{rings:_(n.rings,t),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:_(n.paths,t),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:M(n.points,t),hasM:n.hasM,hasZ:n.hasZ}:void 0}function _(t,n){const i=[];for(const e of t)i.push(M(e,n));return i}function M(t,n){const i=[];for(const e of t){const t=n(e[0],e[1],[0,0]);i.push(t),e.length>2&&t.push(e[2]),e.length>3&&t.push(e[3])}return i}async function X(t,n){if(!n)return;const i=Array.isArray(t)?t.map((t=>{var n;return null==(n=t.geometry)?void 0:n.spatialReference})):[t];await h(i.map((t=>({source:t,dest:n}))))}const Y=g.bind(null,t),v=g.bind(null,n);function B(t,n,e){return t?(e||(e=n,n=t.spatialReference),o(n)&&o(e)&&!i(n,e)?r(n,e)?a(e)?Y(t):v(t):s(x,[t],n,e,null)[0]:t):t}const y=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,n,r){!t||!t.length||!n||!r||i(n,r);const a={geometries:t,inSpatialReference:n,outSpatialReference:r,resolve:null};return this._jobs.push(a),e((t=>{a.resolve=t,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:n,inSpatialReference:i,outSpatialReference:e,resolve:o}=t;r(i,e)?a(e)?o(n.map(Y)):o(n.map(v)):o(s(x,n,i,e,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function b(t,n,i){return y.push(t,n,i)}function z(t,n){if(!(this instanceof z))return new z(t,n);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&("function"==typeof n?this.toBBox=n:this._initFormat(n)),this.clear()}function j(t,n,i){if(!i)return n.indexOf(t);for(var e=0;e<n.length;e++)if(i(t,n[e]))return e;return-1}function w(t,n){S(t,0,t.children.length,n,t)}function S(t,n,i,e,r){r||(r=q(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a,s=n;s<i;s++)a=t.children[s],R(r,t.leaf?e(a):a);return r}function R(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function Z(t,n){return t.minX-n.minX}function A(t,n){return t.minY-n.minY}function E(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function P(t){return t.maxX-t.minX+(t.maxY-t.minY)}function F(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function O(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function q(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function D(t,n,i,e,r){for(var a,s=[n,i];s.length;)(i=s.pop())-(n=s.pop())<=e||(a=n+Math.ceil((i-n)/e/2)*e,p(t,a,n,i,r),s.push(n,a,a,i))}z.prototype={all:function(){return this._all(this.data,[])},search:function(t){var n=this.data,i=[],e=this.toBBox;if(!O(t,n))return i;for(var r,a,s,o,h=[];n;){for(r=0,a=n.children.length;r<a;r++)s=n.children[r],O(t,o=n.leaf?e(s):s)&&(n.leaf?i.push(s):F(t,o)?this._all(s,i):h.push(s));n=h.pop()}return i},collides:function(t){var n=this.data,i=this.toBBox;if(!O(t,n))return!1;for(var e,r,a,s,o=[];n;){for(e=0,r=n.children.length;e<r;e++)if(a=n.children[e],O(t,s=n.leaf?i(a):a)){if(n.leaf||F(t,s))return!0;o.push(a)}n=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var n=0,i=t.length;n<i;n++)this.insert(t[n]);return this}var e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=q([]),this},remove:function(t,n){if(!t)return this;for(var i,e,r,a,s=this.data,o=this.toBBox(t),h=[],l=[];s||h.length;){if(s||(s=h.pop(),e=h[h.length-1],i=l.pop(),a=!0),s.leaf&&-1!==(r=j(t,s.children,n)))return s.children.splice(r,1),h.push(s),this._condense(h),this;a||s.leaf||!F(s,o)?e?(i++,s=e.children[i],a=!1):s=null:(h.push(s),l.push(i),i=0,e=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:Z,compareMinY:A,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,n){for(var i=[];t;)t.leaf?n.push.apply(n,t.children):i.push.apply(i,t.children),t=i.pop();return n},_build:function(t,n,i,e){var r,a=i-n+1,s=this._maxEntries;if(a<=s)return w(r=q(t.slice(n,i+1)),this.toBBox),r;e||(e=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,e-1))),(r=q([])).leaf=!1,r.height=e;var o,h,l,u,c=Math.ceil(a/s),m=c*Math.ceil(Math.sqrt(s));for(D(t,n,i,m,this.compareMinX),o=n;o<=i;o+=m)for(D(t,o,l=Math.min(o+m-1,i),c,this.compareMinY),h=o;h<=l;h+=c)u=Math.min(h+c-1,l),r.children.push(this._build(t,h,u,e-1));return w(r,this.toBBox),r},_chooseSubtree:function(t,n,i,e){for(var r,a,s,o,h,l,u,c,m,f;e.push(n),!n.leaf&&e.length-1!==i;){for(u=c=1/0,r=0,a=n.children.length;r<a;r++)h=E(s=n.children[r]),m=t,f=s,(l=(Math.max(f.maxX,m.maxX)-Math.min(f.minX,m.minX))*(Math.max(f.maxY,m.maxY)-Math.min(f.minY,m.minY))-h)<c?(c=l,u=h<u?h:u,o=s):l===c&&h<u&&(u=h,o=s);n=o||n.children[0]}return n},_insert:function(t,n,i){var e=this.toBBox,r=i?t:e(t),a=[],s=this._chooseSubtree(r,this.data,n,a);for(s.children.push(t),R(s,r);n>=0&&a[n].children.length>this._maxEntries;)this._split(a,n),n--;this._adjustParentBBoxes(r,a,n)},_split:function(t,n){var i=t[n],e=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,e);var a=this._chooseSplitIndex(i,r,e),s=q(i.children.splice(a,i.children.length-a));s.height=i.height,s.leaf=i.leaf,w(i,this.toBBox),w(s,this.toBBox),n?t[n-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(t,n){this.data=q([t,n]),this.data.height=t.height+1,this.data.leaf=!1,w(this.data,this.toBBox)},_chooseSplitIndex:function(t,n,i){var e,r,a,s,o,h,l,u,c,m,f,x,p,d;for(h=l=1/0,e=n;e<=i-n;e++)c=r=S(t,0,e,this.toBBox),m=a=S(t,e,i,this.toBBox),void 0,void 0,void 0,void 0,f=Math.max(c.minX,m.minX),x=Math.max(c.minY,m.minY),p=Math.min(c.maxX,m.maxX),d=Math.min(c.maxY,m.maxY),s=Math.max(0,p-f)*Math.max(0,d-x),o=E(r)+E(a),s<h?(h=s,u=e,l=o<l?o:l):s===h&&o<l&&(l=o,u=e);return u},_chooseSplitAxis:function(t,n,i){var e=t.leaf?this.compareMinX:Z,r=t.leaf?this.compareMinY:A;this._allDistMargin(t,n,i,e)<this._allDistMargin(t,n,i,r)&&t.children.sort(e)},_allDistMargin:function(t,n,i,e){t.children.sort(e);var r,a,s=this.toBBox,o=S(t,0,n,s),h=S(t,i-n,i,s),l=P(o)+P(h);for(r=n;r<i-n;r++)a=t.children[r],R(o,t.leaf?s(a):a),l+=P(o);for(r=i-n-1;r>=n;r--)a=t.children[r],R(h,t.leaf?s(a):a),l+=P(h);return l},_adjustParentBBoxes:function(t,n,i){for(var e=i;e>=0;e--)R(n[e],t)},_condense:function(t){for(var n,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():w(t[i],this.toBBox)},_initFormat:function(t){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(t[0])),this.compareMinY=new Function("a","b",n.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};const I=(t,n,i)=>[n,i],J=(t,n,i)=>[n,i,t[2]],L=(t,n,i)=>[n,i,t[2],t[3]];function N(t){return t?{originPosition:"upper-left"===t.originPosition?"upperLeft":"lower-left"===t.originPosition?"lowerLeft":t.originPosition,scale:[t.tolerance,t.tolerance],translate:[t.extent.xmin,t.extent.ymax]}:null}function T({scale:t,translate:n},i){return Math.round((i-n[0])/t[0])}function k({scale:t,translate:n},i){return Math.round((n[1]-i)/t[1])}function C(t,n,i){const e=[];let r,a,s,o;for(let h=0;h<i.length;h++){const l=i[h];h>0?(s=T(t,l[0]),o=k(t,l[1]),s===r&&o===a||(e.push(n(l,s-r,o-a)),r=s,a=o)):(r=T(t,l[0]),a=k(t,l[1]),e.push(n(l,r,a)))}return e.length>0?e:null}function H({scale:t,translate:n},i){return i*t[0]+n[0]}function G({scale:t,translate:n},i){return n[1]-i*t[1]}function K(t,n,i){const e=new Array(i.length);if(!i.length)return e;const[r,a]=t.scale;let s=H(t,i[0][0]),o=G(t,i[0][1]);e[0]=n(i[0],s,o);for(let t=1;t<i.length;t++){const h=i[t];s+=h[0]*r,o-=h[1]*a,e[t]=n(h,s,o)}return e}function Q(t,n,i){const e=new Array(i.length);for(let r=0;r<i.length;r++)e[r]=K(t,n,i[r]);return e}function U(t,n,i,e,r){return n.points=function(t,n,i,e){return C(t,i?e?L:J:e?J:I,n)}(t,i.points,e,r),n}function V(t,n,i,e,r){return n.x=T(t,i.x),n.y=k(t,i.y),n!==i&&(e&&(n.z=i.z),r&&(n.m=i.m)),n}function W(t,n,i,e,r){const a=function(t,n,i,e){const r=[],a=i?e?L:J:e?J:I;for(let i=0;i<n.length;i++){const e=C(t,a,n[i]);e&&e.length>=3&&r.push(e)}return r.length?r:null}(t,i.rings,e,r);return a?(n.rings=a,n):null}function $(t,n,i,e,r){const a=function(t,n,i,e){const r=[],a=i?e?L:J:e?J:I;for(let i=0;i<n.length;i++){const e=C(t,a,n[i]);e&&e.length>=2&&r.push(e)}return r.length?r:null}(t,i.paths,e,r);return a?(n.paths=a,n):null}function tt(t,n){return t&&n?l(n)?V(t,{},n,!1,!1):u(n)?$(t,{},n,!1,!1):c(n)?W(t,{},n,!1,!1):m(n)?U(t,{},n,!1,!1):f(n)?function(t,n,i,e,r){return n.xmin=T(t,i.xmin),n.ymin=k(t,i.ymin),n.xmax=T(t,i.xmax),n.ymax=k(t,i.ymax),n!==i&&(e&&(n.zmin=i.zmin,n.zmax=i.zmax),r&&(n.mmin=i.mmin,n.mmax=i.mmax)),n}(t,{},n,!1,!1):null:null}function nt(t,n,i,e,r){return n.points=function(t,n,i,e){return K(t,i?e?L:J:e?J:I,n)}(t,i.points,e,r),n}function it(t,n,i,e,r){return n.x=H(t,i.x),n.y=G(t,i.y),n!==i&&(e&&(n.z=i.z),r&&(n.m=i.m)),n}function et(t,n,i,e,r){return n.rings=function(t,n,i,e){return Q(t,i?e?L:J:e?J:I,n)}(t,i.rings,e,r),n}function rt(t,n,i,e,r){return n.paths=function(t,n,i,e){return Q(t,i?e?L:J:e?J:I,n)}(t,i.paths,e,r),n}export{V as L,nt as U,tt as d,X as f,B as g,z as i,b as j,it as k,N as m,et as q,rt as v};
