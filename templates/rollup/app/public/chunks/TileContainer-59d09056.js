import{bG as e,d as s,bI as t,bJ as r}from"../main.js";import{I as i}from"./Utils-b46864a6.js";import{a as o}from"./Container-c6c95dc1.js";import{b as n,c as a,r as l}from"./WGLContainer-720c8185.js";class c extends o{constructor(t,r,i,o=i){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:e(),tileMat3:e()},this.triangleCount=0,this.key=new s(t),this.bounds=r,this.size=i,this.coordRange=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,s){const i=s/(e.resolution*e.pixelRatio),o=this.transforms.tileMat3,[n,a]=e.toScreenNoRotation([0,0],this.coords),l=this.size[0]/this.coordRange[0]*i,c=this.size[1]/this.coordRange[1]*i;t(o,l,0,0,0,c,0,n,a,1),r(this.transforms.dvs,e.displayViewMat3,o)}}const h=(e,s)=>e.key.level-s.key.level!=0?e.key.level-s.key.level:e.key.row-s.key.row!=0?e.key.row-s.key.row:e.key.col-s.key.col;class d extends n{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(h),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:s}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(s.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(s.scale)}}prepareRenderPasses(e){const s=e.registerRenderPass({name:"stencil",brushes:[a],drawPhase:i.DEBUG|i.MAP,target:()=>this.getStencilTarget()}),t=e.registerRenderPass({name:"tileInfo",brushes:[l],drawPhase:i.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(e),s,t]}getStencilTarget(){return this.children}updateTransforms(e){for(const s of this.children){const t=this._tileInfoView.getTileResolution(s.key);s.setTransform(e,t)}}setStencilReference(){let e=1;for(const s of this.children)s.stencilRef=e++}}export{d,c as r};
