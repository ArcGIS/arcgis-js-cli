import{A as e,v as t,bo as n,aB as r,U as a,cs as o,a5 as c,aD as s,c0 as l,c1 as i,aT as u}from"../main.js";import{i as f,h,N as d,D as p,o as g,P as E,F as m,q as y,S as v,a as w,b as N,c as I,d as b,T,e as S,j as R,_ as O,f as U,u as A,g as C,m as x,p as F,A as M,k as D,v as P,w as L,Q as k,B as _,U as j,l as V,n as B,I as Y,r as G,O as z,Z as H,s as q,t as Z,E as W,x as K,y as X,z as J,C as Q}from"./arcadeUtils-f665f7ae.js";import"./number-c01be8dd.js";import"./featureConversionUtils-0e5f7c52.js";import"./centroid-aa1305d6.js";import"./FeatureSetReader-b7349ae0.js";import"./geometryEngineAsync-bc28b6ac.js";import{registerFunctions as $}from"./geomasync-e84771e2.js";function ee(e){return e instanceof Error?n(e):n(new Error(e))}function te(e){return a(e)}function ne(e,n){const r=[];for(let t=0;t<n.arguments.length;t++)r.push(oe(e,n.arguments[t]));return t(r)}function re(t,n,r){return e(((e,a)=>{ne(t,n).then((o=>{try{e(r(t,n,o))}catch(e){a(e)}}),a)}))}function ae(e,t,n){try{return ne(e,t).then((r=>{try{const c=n(e,t,r);return(o=c)&&"function"==typeof o.then?c:a(c)}catch(e){return ee(e)}var o}))}catch(e){return ee(e)}}function oe(r,c){try{switch(c.type){case"VariableDeclarator":return function(t,n){try{let r=null;return r=null===n.init?a(null):oe(t,n.init),null!==t.localScope?r.then((r=>e((e=>{if(r===S&&(r=null),"Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const a=n.id.name.toLowerCase();t.localScope[a]={value:r,valueset:!0,node:n.init},e(S)})))):r.then((r=>e((e=>{if("Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const a=n.id.name.toLowerCase();r===S&&(r=null),t.globalScope[a]={value:r,valueset:!0,node:n.init},e(S)}))))}catch(e){return ee(e)}}(r,c);case"VariableDeclaration":return pe(r,c,0);case"BlockStatement":return function(e,t){try{return de(e,t,0)}catch(e){return ee(e)}}(r,c);case"FunctionDeclaration":return function(e,t){try{const n=t.id.name.toLowerCase();return e.globalScope[n]={valueset:!0,node:null,value:new U(t,e)},a(S)}catch(e){return ee(e)}}(r,c);case"ReturnStatement":return s=r,l=c,e(((e,t)=>{null===l.argument?e(new b(S)):oe(s,l.argument).then((n=>{try{e(new b(n))}catch(e){t(e)}}),t)}));case"IfStatement":return function(t,n){return e(((e,r)=>{"AssignmentExpression"!==n.test.type&&"UpdateExpression"!==n.test.type?oe(t,n.test).then((a=>{try{!0===a?oe(t,n.consequent).then(e,r):!1===a?null!==n.alternate?oe(t,n.alternate).then(e,r):e(S):r(new Error(D(n.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(e){r(e)}}),r):r(new Error(D(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(r,c);case"ExpressionStatement":return function(t,r){try{return"AssignmentExpression"===r.expression.type?oe(t,r.expression):(r.expression.type,oe(t,r.expression).then((t=>e((e=>{e(t===S?S:new T(t))})))))}catch(e){return n(e)}}(r,c);case"UpdateExpression":return function(t,r){try{const n=r.argument;if("MemberExpression"===n.type){const o={t:null};return oe(t,n.object).then((e=>{let r=null;return o.t=e,!0===n.computed?r=oe(t,n.property):"Identifier"===n.property.type&&(r=a(n.property.name)),r})).then((t=>e((e=>{const n=o.t;let a;if(B(n)){if(!Y(t))throw new Error("Invalid Parameter");if(t<0&&(t=n.length+t),t<0||t>=n.length)throw new Error("Assignment outside of array bounds");a=k(n[t]),n[t]="++"===r.operator?a+1:a-1}else if(n instanceof N){if(!1===L(t))throw new Error("Dictionary accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");a=k(n.field(t)),n.setField(t,"++"===r.operator?a+1:a-1)}else{if(!(n instanceof I))throw G(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===L(t))throw new Error("Feature accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");a=k(n.field(t)),n.setField(t,"++"===r.operator?a+1:a-1)}!1===r.prefix?e(a):e("++"===r.operator?a+1:a-1)}))))}return e(((e,n)=>{const a="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!a)throw new Error("Invalid identifier");let o;return null!==t.localScope&&void 0!==t.localScope[a]?(o=k(t.localScope[a].value),t.localScope[a]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},void(!1===r.prefix?e(o):e("++"===r.operator?o+1:o-1))):void 0!==t.globalScope[a]?(o=k(t.globalScope[a].value),t.globalScope[a]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},void(!1===r.prefix?e(o):e("++"===r.operator?o+1:o-1))):void n(new Error("Variable not recognised"))}))}catch(e){return n(e)}}(r,c);case"AssignmentExpression":return function(t,n){return e(((e,r)=>{const o=n.left;if("MemberExpression"===o.type)oe(t,n.right).then((c=>{try{oe(t,o.object).then((s=>{try{let l=null;if(!0===o.computed)l=oe(t,o.property);else{if("Identifier"!==o.property.type)throw new Error("Expected computed or identifier for assignemnt target");l=a(o.property.name)}l.then((t=>{try{if(B(s)){if(!Y(t))throw new Error("Invalid Parameter");if(t<0&&(t=s.length+t),t<0||t>s.length)throw new Error("Assignment outside of array bounds");if(t===s.length){if("="!==n.operator)throw new Error("Invalid Parameter");s[t]=he(c,n.operator,s[t],n)}else s[t]=he(c,n.operator,s[t],n)}else if(s instanceof N){if(!1===L(t))throw new Error("Dictionary accessor must be a string");if(!0===s.hasField(t))s.setField(t,he(c,n.operator,s.field(t),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");s.setField(t,he(c,n.operator,null,n))}}else{if(!(s instanceof I))throw G(s)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===L(t))throw new Error("Feature accessor must be a string");if(!0===s.hasField(t))s.setField(t,he(c,n.operator,s.field(t),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");s.setField(t,he(c,n.operator,null,n))}}e(S)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r);else{const a=o.name.toLowerCase();if(null!==t.localScope&&void 0!==t.localScope[a])return void oe(t,n.right).then((o=>{try{t.localScope[a]={value:he(o,n.operator,t.localScope[a].value,n),valueset:!0,node:n.right},e(S)}catch(e){r(e)}}),r);void 0!==t.globalScope[a]?oe(t,n.right).then((o=>{try{t.globalScope[a]={value:he(o,n.operator,t.globalScope[a].value,n),valueset:!0,node:n.right},e(S)}catch(e){r(e)}}),r):r(new Error("Cannot assign undeclared variable"))}}))}(r,c);case"ForStatement":return function(t,r){try{return null!==r.init?oe(t,r.init).then((()=>e(((e,n)=>{se(t,r,{testResult:!0,lastAction:S},(t=>{e(t)}),(e=>{n(e)}),0)})))):e(((e,n)=>{se(t,r,{testResult:!0,lastAction:S},(t=>{e(t)}),(e=>{n(e)}),0)}))}catch(e){return n(e)}}(r,c);case"ForInStatement":return function(t,n){return e(((e,r)=>{oe(t,n.right).then((o=>{try{let c=null;c="VariableDeclaration"===n.left.type?oe(t,n.left):a(),c.then((()=>{try{let a="";if("VariableDeclaration"===n.left.type){const e=n.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===n.left.type&&(a=n.left.name);if(!a)throw new Error(D(n,"RUNTIME","INVALIDVARIABLE"));a=a.toLowerCase();let c=null;if(null!==t.localScope&&void 0!==t.localScope[a]&&(c=t.localScope[a]),null===c&&void 0!==t.globalScope[a]&&(c=t.globalScope[a]),null===c)return void r(new Error(D(n,"RUNTIME","VARIABLENOTDECLARED")));B(o)||L(o)?ue(t,n,o,{reject:r,resolve:e},c):G(o)?function(e,t,n,r,a,o){try{if(void 0===o&&(o="i"),0===n.length)return void r.resolve(S);ie(e,t,n,a,0,o,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(e){r.reject(e)}}(t,n,o,{reject:r,resolve:e},c):o instanceof N||o instanceof I?function(e,t,n,r,a){try{ue(e,t,n.keys(),r,a,"k")}catch(e){r.reject(e)}}(t,n,o,{reject:r,resolve:e},c):H(o)?fe(o.iterator(t.abortSignal),t,n,o,c,(t=>{e(t)}),(e=>{r(e)}),0):ue(t,n,[],{reject:r,resolve:e},c)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r)}))}(r,c);case"BreakStatement":return a(R);case"EmptyStatement":return a(S);case"ContinueStatement":return a(O);case"TemplateElement":return function(e,t){return a(t.value?t.value.cooked:"")}(0,c);case"TemplateLiteral":return function(t,n){return e((e=>{const r=[];z(n.expressions,((e,n,a,o)=>oe(t,n).then((e=>{r[a]=_(e)})))).then((()=>{let t="",a=0;for(const e of n.quasis)t+=e.value?e.value.cooked:"",!1===e.tail&&(t+=r[a]?r[a]:"",a++);e(t)}))}))}(r,c);case"Identifier":return me(r,c);case"MemberExpression":return function(t,r){try{return oe(t,r.object).then((c=>{try{return null===c?n(new Error(D(r,"RUNTIME","NOTFOUND"))):!1===r.computed?"Identifier"===r.property.type?c instanceof N||c instanceof I?a(c.field(r.property.name)):c instanceof o?a(Ee(c,r.property.name,t,r)):n(new Error(D(r,"RUNTIME","INVALIDTYPE"))):n(new Error(D(r,"RUNTIME","INVALIDTYPE"))):oe(t,r.property).then((n=>e(((e,a)=>{if(c instanceof N||c instanceof I)L(n)?e(c.field(n)):a(new Error(D(r,"RUNTIME","INVALIDTYPE")));else if(c instanceof o)L(n)?e(Ee(c,n,t,r)):a(new Error(D(r,"RUNTIME","INVALIDTYPE")));else if(B(c))if(Y(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length+n),n>=c.length||n<0)throw new Error(D(r,"RUNTIME","OUTOFBOUNDS"));e(c[n])}else a(new Error(D(r,"RUNTIME","INVALIDTYPE")));else if(G(c))if(Y(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length()+n),n>=c.length()||n<0)throw new Error(D(r,"RUNTIME","OUTOFBOUNDS"));e(c.get(n))}else a(new Error(D(r,"RUNTIME","INVALIDTYPE")));else if(L(c))if(Y(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length+n),n>=c.length||n<0)throw new Error(D(r,"RUNTIME","OUTOFBOUNDS"));e(c[n])}else a(new Error(D(r,"RUNTIME","INVALIDTYPE")));else a(new Error(D(r,"RUNTIME","INVALIDTYPE")))}))))}catch(e){return ee(e)}}))}catch(e){return ee(e)}}(r,c);case"Literal":return te(c.value);case"CallExpression":return function(e,t){try{if("Identifier"!==t.callee.type)return ee(D(t,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[t.callee.name.toLowerCase()]){const n=e.localScope[t.callee.name.toLowerCase()];return n.value instanceof v?n.value.fn(e,t):n.value instanceof U?Re(e,t,n.value.definition):ee(D(t,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[t.callee.name.toLowerCase()]){const n=e.globalScope[t.callee.name.toLowerCase()];return n.value instanceof v?n.value.fn(e,t):n.value instanceof U?Re(e,t,n.value.definition):ee(D(t,"RUNTIME","NOTAFUNCTION"))}return ee(D(t,"RUNTIME","NOTFOUND"))}catch(e){return ee(e)}}(r,c);case"UnaryExpression":return function(t,n){try{return oe(t,n.argument).then((t=>e(((e,r)=>{m(t)&&"!"===n.operator?e(!t):"-"===n.operator?e(-1*k(t)):"+"===n.operator?e(1*k(t)):"~"===n.operator?e(~k(t)):r(new Error(D(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))))}catch(e){return ee(e)}}(r,c);case"BinaryExpression":return function(n,r){try{return t([oe(n,r.left),oe(n,r.right)]).then((t=>e(((e,n)=>{const a=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":e(V(k(a),k(o),r.operator));case"==":e(y(a,o));break;case"!=":e(!y(a,o));break;case"<":case">":case"<=":case">=":e(j(a,o,r.operator));break;case"+":L(a)||L(o)?e(_(a)+_(o)):e(k(a)+k(o));break;case"-":e(k(a)-k(o));break;case"*":e(k(a)*k(o));break;case"/":e(k(a)/k(o));break;case"%":e(k(a)%k(o));break;default:n(new Error(D(r,"RUNTIME","OPERATORNOTRECOGNISED")))}}))))}catch(e){return ee(e)}}(r,c);case"LogicalExpression":return function(t,n){return e(((e,r)=>{"AssignmentExpression"!==n.left.type&&"UpdateExpression"!==n.left.type?"AssignmentExpression"!==n.right.type&&"UpdateExpression"!==n.right.type?oe(t,n.left).then((a=>{try{if(!m(a))throw new Error(D(n,"RUNTIME","ONLYBOOLEAN"));switch(n.operator){case"||":!0===a?e(a):oe(t,n.right).then((t=>{try{if(!m(t))throw new Error(D(n,"RUNTIME","ONLYORORAND"));e(t)}catch(e){r(e)}}),r);break;case"&&":!1===a?e(a):oe(t,n.right).then((t=>{try{if(!m(t))throw new Error(D(n,"RUNTIME","ONLYORORAND"));e(t)}catch(e){r(e)}}),r);break;default:throw new Error(D(n,"RUNTIME","ONLYORORAND"))}}catch(e){r(e)}}),r):r(new Error(D(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):r(new Error(D(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(r,c);case"ConditionalExpression":return ee(D(c,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(n,r){try{const a=[];for(let e=0;e<r.elements.length;e++)a.push(oe(n,r.elements[e]));return t(a).then((t=>e(((e,n)=>{for(let e=0;e<t.length;e++){if(P(t[e]))return void n(new Error(D(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));t[e]===S&&(t[e]=null)}e(t)}))))}catch(e){return ee(e)}}(r,c);case"ObjectExpression":return function(n,r){try{const a=[];for(let e=0;e<r.properties.length;e++)a.push(oe(n,r.properties[e]));return t(a).then((t=>e((e=>{const n={};for(let e=0;e<t.length;e++){const r=t[e];if(P(r.value))throw new Error("Illegal Argument");if(!1===L(r.key))throw new Error("Illegal Argument");r.value===S?n[r.key.toString()]=null:n[r.key.toString()]=r.value}const r=new N(n);r.immutable=!1,e(r)}))))}catch(e){return ee(e)}}(r,c);case"Property":return function(t,r){try{return oe(t,r.value).then((n=>e((e=>{"Identifier"===r.key.type?e({key:r.key.name,value:n}):oe(t,r.key).then((t=>{e({key:t,value:n})}))}))))}catch(e){return n(e)}}(r,c);default:return ee(D(c,"RUNTIME","UNREOGNISED"))}}catch(e){return ee(e)}var s,l}function ce(e,t,r){try{return oe(e,t.body).then((o=>{try{return r.lastAction=o,r.lastAction===R||r.lastAction instanceof b?(r.testResult=!1,a(r)):null!==t.update?oe(e,t.update).then((()=>a(r))):a(r)}catch(e){return n(e)}}))}catch(e){return n(e)}}function se(e,t,r,o,c,s){try{(function(e,t,r){try{return null!==t.test?oe(e,t.test).then((o=>{try{return!0===e.abortSignal.aborted?n(new Error("Cancelled")):(r.testResult=o,!1===r.testResult?a(r):!0!==r.testResult?n(new Error(D(t,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):ce(e,t,r))}catch(e){return n(e)}})):ce(e,t,r)}catch(e){return n(e)}})(e,t,r).then((()=>{try{!0===r.testResult?++s>100?(s=0,setTimeout((()=>{se(e,t,r,o,c,s)}),0)):se(e,t,r,o,c,s):r.lastAction instanceof b?o(r.lastAction):o(S)}catch(e){c(e)}}),(e=>{c(e)}))}catch(e){c(e)}}function le(e,t,n,r,a,o,c,s,l,i){try{if(r<=o)return void s(S);a.value="k"===c?n[o]:o,oe(e,t.body).then((u=>{try{u instanceof b?s(u):u===R?s(S):++i>100?(i=0,setTimeout((()=>{le(e,t,n,r,a,o+1,c,s,l,i)}),0)):le(e,t,n,r,a,o+1,c,s,l,i)}catch(e){l(e)}}),(e=>{l(e)}))}catch(e){l(e)}}function ie(e,t,n,r,a,o,c,s,l){try{if(n.length()<=a)return void c(S);r.value="k"===o?n.get(a):a,oe(e,t.body).then((i=>{i instanceof b?c(i):i===R?c(S):++l>100?(l=0,setTimeout((()=>{ie(e,t,n,r,a+1,o,c,s,l)}),0)):ie(e,t,n,r,a+1,o,c,s,l)}),(e=>{s(e)}))}catch(e){s(e)}}function ue(e,t,n,r,a,o){try{if(void 0===o&&(o="i"),0===n.length)return void r.resolve(S);le(e,t,n,n.length,a,0,o,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(e){r.reject(e)}}function fe(e,t,n,r,a,o,c,s){try{e.next().then((l=>{try{if(null===l)o(S);else{const i=I.createFromGraphicLikeObject(l.geometry,l.attributes,r);i._underlyingGraphic=l,a.value=i,oe(t,n.body).then((l=>{try{l===R?o(S):l instanceof b?o(l):++s>100?(s=0,setTimeout((()=>{fe(e,t,n,r,a,o,c,s)}),0)):fe(e,t,n,r,a,o,c,s)}catch(e){c(e)}}),(e=>{c(e)}))}}catch(e){c(e)}}),(e=>{c(e)}))}catch(e){c(e)}}function he(e,t,n,r){switch(t){case"=":return e===S?null:e;case"/=":return k(n)/k(e);case"*=":return k(n)*k(e);case"-=":return k(n)-k(e);case"+=":return L(n)||L(e)?_(n)+_(e):k(n)+k(e);case"%=":return k(n)%k(e);default:throw new Error(D(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}function de(t,n,r){try{return r>=n.body.length?a(S):e(((e,a)=>{oe(t,n.body[r]).then((o=>{try{o instanceof b||o===R||o===O||r===n.body.length-1?e(o):de(t,n,r+1).then(e,a)}catch(e){a(e)}}),a)}))}catch(e){return ee(e)}}function pe(t,n,r){return e(((e,a)=>{r>=n.declarations.length?e(S):oe(t,n.declarations[r]).then((()=>{r===n.declarations.length-1?e(S):pe(t,n,r+1).then((()=>{e(S)}),a)}),a)}))}let ge=0;function Ee(e,t,n,r){let a;switch(t=t.toLowerCase()){case"hasz":{const t=e.hasZ;return void 0!==t&&t}case"hasm":{const t=e.hasM;return void 0!==t&&t}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let n=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(n=!1),n&&(ge++,e.spatialReference._arcadeCacheId=ge,t=ge)}const n=new N({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const n=e[t];return void 0!==n?n:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return a=e.cache._arcadeCacheId,void 0===a&&(ge++,a=ge,e.cache._arcadeCacheId=a),new Z(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==e[t]?e[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return a=e.cache._arcadeCacheId,void 0===a&&(ge++,a=ge,e.cache._arcadeCacheId=a),new Z(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return a=e.cache._arcadeCacheId,void 0===a&&(ge++,a=ge,e.cache._arcadeCacheId=a),new q(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,a,1);case"type":return"Multipoint"}}throw new Error(D(r,"RUNTIME","PROPERTYNOTFOUND"))}function me(t,n){return e(((e,r)=>{const a=n.name.toLowerCase();if(null===t.localScope||void 0===t.localScope[a])if(void 0===t.globalScope[a])r(new Error(D(n,"RUNTIME","VARIABLENOTFOUND")));else{const n=t.globalScope[a];!0===n.valueset?e(n.value):null!==n.d?n.d.then(e,r):(n.d=oe(t,n.node),n.d.then((t=>{try{n.value=t,n.valueset=!0,e(t)}catch(e){r(e)}}),r))}else{const n=t.localScope[a];!0===n.valueset?e(n.value):null!==n.d?n.d.then(e,r):(n.d=oe(t,n.node),n.d.then((t=>{try{n.value=t,n.valueset=!0,e(t)}catch(e){r(e)}}),r))}}))}const ye={};function ve(e){return null===e?"":B(e)||G(e)?"Array":W(e)?"Date":L(e)?"String":m(e)?"Boolean":Y(e)?"Number":e instanceof K?"Attachment":e instanceof X?"Portal":e instanceof N?"Dictionary":e instanceof I?"Feature":e instanceof c?"Point":e instanceof s?"Polygon":e instanceof l?"Polyline":e instanceof i?"Multipoint":e instanceof u?"Extent":P(e)?"Function":H(e)?"FeatureSet":J(e)?"FeatureSetCollection":e===S?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function we(t,n,r,a){return e(((e,o)=>{oe(t,n.arguments[r]).then((c=>{try{if(y(c,a))return void oe(t,n.arguments[r+1]).then(e,o);{const c=n.arguments.length-r;return 1===c?void oe(t,n.arguments[r]).then(e,o):(2===c&&e(null),3===c?void oe(t,n.arguments[r+2]).then(e,o):void we(t,n,r+2,a).then(e,o))}}catch(e){o(e)}}),o)}))}function Ne(t,n,r,a){return e(((e,o)=>{!0===a?oe(t,n.arguments[r+1]).then(e,o):3==n.arguments.length-r?oe(t,n.arguments[r+2]).then(e,o):oe(t,n.arguments[r+2]).then((a=>{try{if(!1===m(a))return void o(new Error("WHEN needs boolean test conditions"));Ne(t,n,r+2,a).then(e,o)}catch(e){o(e)}}))}))}function Ie(n,r){try{const o=n.length,c=Math.floor(o/2);return 0===o?a([]):1===o?a([n[0]]):e(((e,a)=>{const s=[Ie(n.slice(0,c),r),Ie(n.slice(c,o),r)];t(s).then((t=>{try{be(t[0],t[1],r,[]).then(e,a)}catch(e){a(e)}}),a)}))}catch(e){return ee(e)}}function be(t,n,r,a){return e(((e,o)=>{const c=a;t.length>0||n.length>0?t.length>0&&n.length>0?r(t[0],n[0]).then((s=>{try{isNaN(s)&&(s=1),s<=0?(c.push(t[0]),t=t.slice(1)):(c.push(n[0]),n=n.slice(1)),be(t,n,r,a).then(e,o)}catch(e){o(e)}}),o):t.length>0?(c.push(t[0]),be(t=t.slice(1),n,r,a).then(e,o)):n.length>0&&(c.push(n[0]),n=n.slice(1),be(t,n,r,a).then(e,o)):e(a)}))}function Te(e,t){const n=e.length,r=Math.floor(n/2);return t||(t=function(e,t){return e<t?-1:e===t?0:1}),0===n?[]:1===n?[e[0]]:function(e,t,n){const r=[];for(;e.length>0||t.length>0;)if(e.length>0&&t.length>0){let a=n(e[0],t[0]);isNaN(a)&&(a=1),a<=0?(r.push(e[0]),e=e.slice(1)):(r.push(t[0]),t=t.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):t.length>0&&(r.push(t[0]),t=t.slice(1));return r}(Te(e.slice(0,r),t),Te(e.slice(r,n),t),t)}function Se(t,r,a){try{const n=t.body;if(a.length!==t.params.length)return ee(new Error("Invalid Parameter calls to function."));for(let e=0;e<a.length;e++){const n=t.params[e];"Identifier"===n.type&&(r.localScope[n.name.toLowerCase()]={d:null,value:a[e],valueset:!0,node:null})}return oe(r,n).then((t=>e(((e,n)=>{t instanceof b?e(t.value):t!==R?t!==O?e(t instanceof T?t.value:t):n(new Error("Cannot Continue from a Function")):n(new Error("Cannot Break from a Function"))}))))}catch(e){return n(e)}}function Re(e,t,n){return ae(e,t,(function(t,r,a){const o={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(o.depthCounter>64)throw new Error("Exceeded maximum function depth");return Se(n,o,a)}))}function Oe(e){return function(){const t={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(t.depthCounter>64)throw new Error("Exceeded maximum function depth");return Se(e.definition,t,arguments)}}f(ye,re),h(ye,re),d(ye,re),p(ye,re),g(ye,re),$({functions:ye,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:re,standardFunctionAsync:ae}),ye.typeof=function(e,t){return re(e,t,(function(e,t,n){E(n,1,1);const r=ve(n[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r}))},ye.iif=function(n,r){return e(((e,a)=>{E(null===r.arguments?[]:r.arguments,3,3),oe(n,r.arguments[0]).then((o=>{try{if(!1===m(o))return void a(new Error("IF Function must have a boolean test condition"));t([oe(n,r.arguments[1]),oe(n,r.arguments[2])]).then((t=>{e(o?t[0]:t[1])}),a)}catch(e){a(e)}}),a)}))},ye.decode=function(t,n){return e(((e,r)=>{n.arguments.length<2?r(new Error("Missing Parameters")):2!==n.arguments.length?(n.arguments.length-1)%2!=0?oe(t,n.arguments[0]).then((a=>{try{we(t,n,1,a).then(e,r)}catch(e){r(e)}}),r):r(new Error("Must have a default value result.")):oe(t,n.arguments[1]).then(e,r)}))},ye.when=function(t,n){try{return n.arguments.length<3?ee("Missing Parameters"):n.arguments.length%2==0?ee("Must have a default value result."):oe(t,n.arguments[0]).then((r=>e(((e,a)=>{!1!==m(r)?Ne(t,n,0,r).then(e,a):a(new Error("WHEN needs boolean test conditions"))}))))}catch(e){return ee(e)}},ye.sort=function(e,t){return ae(e,t,(function(e,t,n){E(n,1,2);let r=n[0];if(G(r)&&(r=r.toArray()),!1===B(r))return ee(Error("Illegal Argument"));if(n.length>1)return!1===P(n[1])?ee(Error("Illegal Argument")):Ie(r,Oe(n[1]));{let e=r;if(0===e.length)return a([]);const t={};for(let n=0;n<e.length;n++){const r=ve(e[n]);""!==r&&(t[r]=!0)}if(!0===t.Array||!0===t.Dictionary||!0===t.Feature||!0===t.Point||!0===t.Polygon||!0===t.Polyline||!0===t.Multipoint||!0===t.Extent||!0===t.Function)return a(e.slice(0));let n=0,o="";for(const e in t)n++,o=e;return n>1||"String"===o?e=Te(e,(function(e,t){if(null==e||e===S)return null==t||t===S?0:1;if(null==t||t===S)return-1;const n=_(e),r=_(t);return n<r?-1:n===r?0:1})):"Number"===o?e=Te(e,(function(e,t){return e-t})):"Boolean"===o?e=Te(e,(function(e,t){return e===t?0:t?-1:1})):"Date"===o&&(e=Te(e,(function(e,t){return t-e}))),a(e)}}))};const Ue={failDefferred:ee,resolveDeffered:te,fixSpatialReference:Q,parseArguments:ne,standardFunction:re,standardFunctionAsync:ae,evaluateIdentifier:me,arcadeCustomFunction:Oe};for(const e in ye)ye[e]={value:new v(ye[e]),valueset:!0,node:null};const Ae=function(){};function Ce(e){console.log(e)}(Ae.prototype=ye).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Ae.prototype.pi={value:Math.PI,valueset:!0,node:null};const xe=Ue;function Fe(e){const t={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:re,standardFunctionAsync:ae,failDefferred:ee,evaluateIdentifier:me,arcadeCustomFunctionHandler:Oe};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(const e in t.functions)ye[e]={value:new v(t.functions[e]),valueset:!0,node:null},Ae.prototype[e]=ye[e];for(let e=0;e<t.signatures.length;e++)w(t.signatures[e],"async")}function Me(t,n){let a=n.spatialReference;null==a&&(a=new r({wkid:102100}));const o=function(e,t){const n=new Ae;null==e&&(e={}),null==t&&(t={});const r=new N({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});r.immutable=!1,n.textformatting={value:r,valueset:!0,node:null};for(const e in t)n[e]={value:new v(t[e]),native:!0,valueset:!0,node:null};for(const t in e)e[t]&&"esri.Graphic"===e[t].declaredClass?n[t]={value:I.createFromGraphic(e[t]),valueset:!0,node:null}:n[t]={value:e[t],valueset:!0,node:null};return n}(n.vars,n.customfunctions);return oe({spatialReference:a,services:n.services,abortSignal:void 0===n.abortSignal||null===n.abortSignal?{aborted:!1}:n.abortSignal,globalScope:o,console:n.console?n.console:Ce,lrucache:n.lrucache,localScope:null,depthCounter:1},t.body[0].body).then((t=>e(((e,n)=>{t instanceof b&&(t=t.value),t instanceof T&&(t=t.value),t===S&&(t=null),t!==R?t!==O?t instanceof v||t instanceof U?n(new Error("Cannot return FUNCTION")):e(t):n(new Error("Cannot return CONTINUE")):n(new Error("Cannot return BREAK"))}))))}function De(e,t){return A(e)}function Pe(e,t){return C(e,t,"full")}function Le(e,t){return x(e,t)}function ke(e,t){return F(e,t)}function _e(e){return M(e)}export{Me as executeScript,Fe as extend,De as extractFieldLiterals,_e as findFunctionCalls,xe as functionHelper,ke as referencesFunction,Le as referencesMember,Pe as validateScript};
