import{cr as e,k as r,L as a,a as t}from"../main.js";import{a as l}from"./lazyLayerLoader-c27264ad.js";async function n(a){const n=await async function(a){const t=e(a);if(!t)throw new r("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:a});const{serverType:n,sublayer:s}=t;let i;const y={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(n){case"MapServer":i=null!=s?"FeatureLayer":async function(e){return(await u(e)).tileInfo}(a).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":i=u(a).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?r&&"LERC"===r.toUpperCase()&&e.cacheType&&"elevation"===e.cacheType.toLowerCase()?"ElevationLayer":"ImageryTileLayer":"ImageryLayer"}));break;case"SceneServer":i=u(t.url.path).then((e=>{const r={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const a=e.layers[0].layerType;if(null!=r[a])return r[a]}return"SceneLayer"}));break;default:i=y[n]}const c="FeatureServer"===n,d={parsedUrl:t,Constructor:null,layerOrTableId:c?s:null,sublayerIds:null,tableIds:null},f=await i;if({FeatureLayer:!0,SceneLayer:!0}[f]&&null==s){const e=await async function(e,r){var a,t;let l,n=!1;if("FeatureServer"===r){const r=await async function(e){var r,a;let t=await u(e);t=t||{},t.layers=(null==(r=t.layers)?void 0:r.filter(o))||[];const l={serviceJSON:t};if(t.currentVersion<10.5)return l;const n=await u(e+"/layers");return l.layersJSON={layers:(null==n||null==(a=n.layers)?void 0:a.filter(o))||[],tables:(null==n?void 0:n.tables)||[]},l}(e);n=!!r.layersJSON,l=r.layersJSON||r.serviceJSON}else l=await u(e);const s=null==(a=l)?void 0:a.layers,i=null==(t=l)?void 0:t.tables;return{layerIds:(null==s?void 0:s.map((e=>e.id)).reverse())||[],tableIds:(null==i?void 0:i.map((e=>e.id)).reverse())||[],layerInfos:n?s:[],tableInfos:n?i:[]}}(a,n);if(c&&(d.sublayerInfos=e.layerInfos,d.tableInfos=e.tableInfos),1!==e.layerIds.length+e.tableIds.length)d.sublayerIds=e.layerIds,d.tableIds=e.tableIds;else if(c){var I,b;d.layerOrTableId=null!=(I=e.layerIds[0])?I:e.tableIds[0],d.sourceJSON=null!=(b=e.layerInfos[0])?b:e.tableInfos[0]}}return d.Constructor=await async function(e){return(0,l[e])()}(f),d}(a.url),i={...a.properties,url:a.url};if(!n.sublayerIds)return null!=n.layerOrTableId&&(i.layerId=n.layerOrTableId,i.sourceJSON=n.sourceJSON),new n.Constructor(i);const y=new((await import("./GroupLayer-6c1329b2.js")).default)({title:n.parsedUrl.title});return function(e,r,a){function l(e,l){const n={...a,layerId:e,sublayerTitleMode:"service-name"};return t(l)&&(n.sourceJSON=l),new r.Constructor(n)}r.sublayerIds.forEach((a=>{const t=l(a,s(r.sublayerInfos,a));e.add(t)})),r.tableIds.forEach((a=>{const t=l(a,s(r.tableInfos,a));e.tables.add(t)}))}(y,n,i),y}function s(e,r){return e?e.find((e=>e.id===r)):null}function o(e){return!e.type||"Feature Layer"===e.type}async function u(e){return(await a(e,{responseType:"json",query:{f:"json"}})).data}export{n as fromUrl};
