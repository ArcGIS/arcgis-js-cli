import{bg as t,al as n,aB as e,D as s,G as a,H as i,b0 as r,by as o,bz as m,bA as c,j as l,R as x,S as h,V as f,bB as u,aF as y,aH as p,b2 as g,aq as b,b1 as d,aC as M,am as S,ao as I,bC as w}from"../main.js";import{y as v,n as L,T as P,c as W,d as A}from"./shapingUtils-e86a3b68.js";const R=Math.PI/180,X=t(),k=i(),z=n();function H(t,n,e,s,a,i,r){if(!s||!e.symbol)return t[0]=t[1]=t[2]=t[3]=0,n[0]=n[1]=n[2]=n[3]=0,t;const o=s;if(!p(o)){g(t,o);let s=n[0];0===s&&(s=K(e),n[0]=s);const i=a*s/2;return t[0]-=i,t[1]-=i,t[2]+=i,t[3]+=i,t}{const s=o.x,m=o.y;"esriTS"===e.symbol.type&&0===n[2]&&0===n[3]&&Q(n,e.symbol,e.mosaicItem),function(t,n,e,s,a,i,r,o){let m;switch(s.type){case"esriSMS":case"esriPMS":m=E(n,e,s,i,r,0);break;case"esriTS":m=U(n,e,s,a,i,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":m=D(n,e,s,i,r,0)}let c,l,x=0;for(let t=0;t<m.rings[0].length-1;t++)l=m.rings[0][t],c=(n-l[0])*(n-l[0])+(e-l[1])*(e-l[1]),x=Math.max(x,c);x=Math.sqrt(x);let h=b(n-x,o),f=b(n+x,o);if(h>f){const t=y(o);if(t){const[n,e]=t.valid;h=n,f=e}}t[0]=h,t[1]=e-x,t[2]=f,t[3]=e+x}(t,s,m,e.symbol,n,a,i,r)}return t}function O(t){return"simple-marker"===t||"picture-marker"===t||"text"===t}function q(t){switch(r(t.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}const C=i(),T=i(),j=i(),F=i(),G=i(),J=i(),N=i();function B(t,n,e,s){a(j,n,e);const i=t.paths;let r,l,x,h,f,u,y,p,g,b=1/0;for(let t=0;t<i.length;t++){const d=i[t];if(!(d.length<2))for(let t=1;t<d.length;t++)r=d[t-1][0],x=d[t-1][1],l=d[t][0],h=d[t][1],f=Math.min(r,l)-s,u=Math.min(x,h)-s,y=Math.max(r,l)+s,p=Math.max(x,h)+s,n<f||n>y||e<u||e>p||(a(C,r,x),a(T,l,h),o(F,T,C),o(G,C,j),m(J,F,c(F,G)/c(F,F)),o(N,G,J),g=c(N,N),b>g&&(b=g))}return Math.sqrt(b)<=s}function E(t,n,e,i,r,o){let m,c;const y=l(e.xoffset),p=l(e.yoffset),g=R*e.angle,b=R*o;switch(e.type){case"esriSMS":m=c=l(e.size);break;case"esriPMS":m=l(e.width),c=l(e.height)}r<.04&&(i=.04*i/r);const d=x(X);h(d,d,a(k,t,n)),f(d,d,b-g),u(d,d,a(k,i,-i)),h(d,d,a(k,y,-p));const M=[0,0];s(M,a(k,-.5*m,-.5*c),d);const S=[0,0];s(S,a(k,-.5*m,.5*c),d);const I=[0,0];s(I,a(k,.5*m,-.5*c),d);const w=[0,0];return s(w,a(k,.5*m,.5*c),d),{rings:[[M,I,w,S,M]]}}function D(t,n,e,i,r,o){const m=v.getEnvelope(e.data);if(!m)return null;r<.04&&(i=.04*i/r);const c=l(m.width),y=l(m.height),p=l(m.x),g=l(m.y),b=0*R,d=R*o,M=x(X);h(M,M,a(k,t,n)),f(M,M,d-b),u(M,M,a(k,i,i));const S=[0,0];s(S,a(k,p,g+y),M);const I=[0,0];s(I,a(k,p,g),M);const w=[0,0];s(w,a(k,p+c,g+y),M);const L=[0,0];return s(L,a(k,p+c,g),M),{rings:[[S,w,L,I,S]]}}function U(t,n,e,i,r,o){const m=l(e.xoffset),c=l(e.yoffset),y=R*e.angle,p=R*o,g=x(X);h(g,g,a(k,t,n)),f(g,g,p),u(g,g,a(k,r,-r));const b=i[0]+i[2]/2,d=i[1]+i[3]/2;h(g,g,a(k,m,-c)),h(g,g,a(k,b,d)),f(g,g,y),h(g,g,a(k,-b,-d));const M=[0,0];s(M,a(k,i[0],i[1]),g);const S=[0,0];s(S,a(k,i[0],i[1]+i[3]),g);const I=[0,0];s(I,a(k,i[0]+i[2],i[1]),g);const w=[0,0];return s(w,a(k,i[0]+i[2],i[1]+i[3]),g),{rings:[[M,I,w,S,M]]}}function V(t){let n,e,s,a,i,r,o,m,c,l=null;if(!t)return null;if("mesh"===t.type)return t.toJSON();if(n=t.spatialReference,e=y(n),!e)return t.toJSON();s=n.isWebMercator,r=s?102100:4326,a=Y[r].maxX,i=Y[r].minX,o=Y[r].plus180Line,m=Y[r].minus180Line;const x=t.toJSON();if(p(x))c=nt(x,a,i);else if(d(x))x.points=x.points.map((t=>nt(t,a,i))),c=x;else if(M(x))c=function(t,n){if(!n)return t;const e=function(t,n){const e=[],{ymin:s,ymax:a}=t,i=t.xmax-t.xmin,r=t.xmin,o=t.xmax;let m;const[c,l]=n.valid;m=$(t.xmin,n);const x=m.x,h=m.frameId;m=$(t.xmax,n);const f=m.x,u=m.frameId,y=x===f&&i>0;if(i>2*l){const t={xmin:r<o?x:f,ymin:s,xmax:l,ymax:a},n={xmin:c,ymin:s,xmax:r<o?f:x,ymax:a},i={xmin:0,ymin:s,xmax:l,ymax:a},m={xmin:c,ymin:s,xmax:0,ymax:a},y=[],p=[];_(t,i)&&y.push(h),_(t,m)&&p.push(h),_(n,i)&&y.push(u),_(n,m)&&p.push(u);for(let t=h+1;t<u;t++)y.push(t),p.push(t);e.push({extent:t,frameIds:[h]},{extent:n,frameIds:[u]},{extent:i,frameIds:y},{extent:m,frameIds:p})}else x>f||y?e.push({extent:{xmin:x,ymin:s,xmax:l,ymax:a},frameIds:[h]},{extent:{xmin:c,ymin:s,xmax:f,ymax:a},frameIds:[u]}):e.push({extent:{xmin:x,ymin:s,xmax:f,ymax:a},frameIds:[h]});return e}(t,n).map((t=>t.extent));return e.length<2?e[0]||t:e.length>2?(t.xmin=n.valid[0],t.xmax=n.valid[1],t):{rings:e.map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}}(x,e);else if(S(x)||I(x)){const t=z;g(t,x);const n={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]},e=Z(n.xmin,i)*(2*a),s=0===e?x:function(t,n){const e=function(t){return S(t)?t.rings:t.paths}(t);for(const t of e)for(const e of t)e[0]+=n;return t}(x,e);n.xmin+=e,n.xmax+=e,w(n,o)&&n.xmax!==a||w(n,m)&&n.xmin!==i?l=s:c=s}else c=t.clone();return null!==l?(new et).cut(l,a):c}function K(t){switch(t.symbol.type){case"esriSFS":case"esriPFS":{const n=t.symbol.outline;return n?n.width:0}case"esriSLS":return t.symbol.width;case"esriSMS":return t.symbol.size;case"esriPMS":return Math.max(t.symbol.width,t.symbol.height);case"esriTS":{const n=[0,0,0,0];Q(n,t.symbol,t.mosaicItem);const e=Math.max(Math.abs(n[0]),Math.abs(n[1]));return Math.max(n[2],n[3])+e}case"expanded-cim":{const n=v.getEnvelope(t.symbol.data);return Math.sqrt(n.width*n.width+n.height*n.height)}case"composite-symbol":{if(!t.symbol.layers.length)return 0;const n=t.symbol.layers.length-1;return K({symbol:t.symbol.layers[n],mosaicItem:null})}case"label":default:return 0}}function Q(t,n,e){if(!e||0===e.glyphMosaicItems.length)return t;const s=L(n.text)[1],a=e.glyphMosaicItems,i=P(a,s,{scale:l(n.font.size)/24,angle:n.angle,xOffset:n.xoffset,yOffset:n.yoffset,hAlign:W(n.horizontalAlignment||"center"),vAlign:A(n.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(n.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(n.lineHeight||1,4)),decoration:n.font.decoration||"none",isCIM:!1}).bounds;return t[0]=i.x-i.halfWidth,t[1]=i.y-i.halfHeight,t[2]=i.width,t[3]=i.height,t}const Y={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:e.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:e.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:e.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:e.WGS84}}};function Z(t,n){return Math.ceil((t-n)/(2*n))}function $(t,n){const[e,s]=n.valid,a=2*s;let i,r=0;return t>s?(i=Math.ceil(Math.abs(t-s)/a),t-=i*a,r=i):t<e&&(i=Math.ceil(Math.abs(t-e)/a),t+=i*a,r=-i),{x:t,frameId:r}}function _(t,n){const{xmin:e,ymin:s,xmax:a,ymax:i}=n;return tt(t,e,s)&&tt(t,e,i)&&tt(t,a,i)&&tt(t,a,s)}function tt(t,n,e){return n>=t.xmin&&n<=t.xmax&&e>=t.ymin&&e<=t.ymax}function nt(t,n,e){if(Array.isArray(t)){const s=t[0];if(s>n){const e=Z(s,n);t[0]=s+e*(-2*n)}else if(s<e){const n=Z(s,e);t[0]=s+n*(-2*e)}}else{const s=t.x;if(s>n){const e=Z(s,n);t.x+=e*(-2*n)}else if(s<e){const n=Z(s,e);t.x+=n*(-2*e)}}return t}class et{cut(t,n){let e;if(t.rings)this.closed=!0,e=t.rings,this.minPts=4;else{if(!t.paths)return null;this.closed=!1,e=t.paths,this.minPts=2}const s=e.length,a=-2*n;for(let t=0;t<s;t++){const n=e[t];if(n&&n.length>=this.minPts){const t=[];for(const e of n)t.push([e[0]+a,e[1]]);e.push(t)}}return this.closed?t.rings=e:t.paths=e,t}}export{U as D,B as E,E as F,D as G,V as K,q as O,Q as V,H as X,O as z};
