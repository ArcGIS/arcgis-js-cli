import{d as e,T as t,U as l}from"../main.js";import{L as i}from"./TilemapCache-461e4d63.js";class r{constructor(e){if(e instanceof i)this._tilemapCache=e;else{if(!e||!("index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}dataKey(l,i){if(this._tilemapCache){const{level:r,row:a,col:o}=l,h=new e(l);return this._tilemapCache.fetchAvailabilityUpsample(r,a,o,h,i).then((()=>(h.world=l.world,h))).catch((e=>{if(t(e))throw e;return null}))}return this._getIndexedDataKey(l)}forEach(e,t,l,i,r){this._callback=r,this._maxLevel=t+e,this._forEach(this._tilemap,t,l,i)}_forEach(e,t,l,i){0!==e&&(this._callback(t,l,i),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*l,2*i),this._forEach(e[1],t+1,2*l,2*i+1),this._forEach(e[2],t+1,2*l+1,2*i),this._forEach(e[3],t+1,2*l+1,2*i+1)))}_getIndexedDataKey(t){const i=[t];if(t.level<0||t.row<0||t.col<0||t.row>>t.level>0||t.col>>t.level>0)return l(null);let r=t;for(;0!==r.level;)r=new e(r.level-1,r.row>>1,r.col>>1,r.world),i.push(r);let a,o,h=this._tilemap,c=i.pop();if(1===h)return l(c);for(;i.length;)if(a=i.pop(),o=(1&a.col)+((1&a.row)<<1),h){if(0===h[o]){c=null;break}if(1===h[o]){c=a;break}c=a,h=h[o]}return l(c)}}export{r as a};
