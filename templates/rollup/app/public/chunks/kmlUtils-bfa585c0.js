import{aB as e,L as t,aR as o,cg as r,dP as n,F as s,dQ as a,cA as i,dC as f,dB as l}from"../main.js";import{S as u,i as y,C as c,f as p}from"./aaBoundingBox-56c013d2.js";const m={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function d(e){const t=e.folders||[],r=t.slice(),n=new Map,s=new Map,a=new Map,i=new Map,f=new Map,l={esriGeometryPoint:s,esriGeometryPolyline:a,esriGeometryPolygon:i};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const t=o(e);t.featureSet.features=[];const r=e.featureSet.geometryType;n.set(r,t);const f=e.layerDefinition.objectIdField;"esriGeometryPoint"===r?G(s,f,e.featureSet.features):"esriGeometryPolyline"===r?G(a,f,e.featureSet.features):"esriGeometryPolygon"===r&&G(i,f,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{f.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((o=>{const n=function(e,t,o){const r=function(e,t){let o;return t.some((t=>t.id===e&&(o=t,!0))),o}(e,o);return r&&(r.parentFolderId=t,r.networkLink=r),r}(o,t.id,e.networkLinks);n&&r.push(n)}))})),r.forEach((e=>{e.featureInfos&&(e.points=o(n.get("esriGeometryPoint")),e.polylines=o(n.get("esriGeometryPolyline")),e.polygons=o(n.get("esriGeometryPolygon")),e.mapImages=[],e.featureInfos.map((t=>{switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const o=l[t.type].get(t.id);o&&e[m[t.type]].featureSet.features.push(o);break}case"GroundOverlay":{const o=f.get(t.id);o&&e.mapImages.push(o);break}}})),e.fullExtent=P([e]))}));const u=P(r);return{folders:t,sublayers:r,extent:u}}function g(e,o,a,i){const f=r&&r.findCredential(e);e=n(e,{token:f&&f.token});const l=s.kmlServiceUrl;return t(l,{query:{url:e,model:"simple",folders:"",refresh:0!==a||void 0,outSR:JSON.stringify(o)},responseType:"json",signal:i})}function S(e,t,o=null,r=[]){const n=[],s={},a=t.sublayers,i=t.folders.map((e=>e.id));return a.forEach((t=>{const a=new e;if(o?a.read(t,o):a.read(t),r.length&&i.indexOf(a.id)>-1&&(a.visible=-1!==r.indexOf(a.id)),s[t.id]=a,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=s[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(a)}else n.unshift(a)})),n}function G(e,t,o){o.forEach((o=>{e.set(o.attributes[t],o)}))}async function h(e){const t=i.fromJSON(e.featureSet).features,o=e.layerDefinition,r=f(o.drawingInfo.renderer),n=l.fromJSON(e.popupInfo),s=[];for(const e of t){const t=await r.getSymbolAsync(e);e.symbol=t,e.popupTemplate=n,e.visible=!0,s.push(e)}return s}function P(t){const o=y(),r=y(c);for(const e of t){if(e.polygons&&e.polygons.featureSet&&e.polygons.featureSet.features)for(const t of e.polygons.featureSet.features)a(o,t.geometry),p(r,o,r);if(e.polylines&&e.polylines.featureSet&&e.polylines.featureSet.features)for(const t of e.polylines.featureSet.features)a(o,t.geometry),p(r,o,r);if(e.points&&e.points.featureSet&&e.points.featureSet.features)for(const t of e.points.featureSet.features)a(o,t.geometry),p(r,o,r);if(e.mapImages)for(const t of e.mapImages)a(o,t.extent),p(r,o,r)}return u(r,c)?null:{xmin:r[0],ymin:r[1],zmin:r[2],xmax:r[3],ymax:r[4],zmax:r[5],spatialReference:e.WGS84}}export{P,S,d,g,h};
