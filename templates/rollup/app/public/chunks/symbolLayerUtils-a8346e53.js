import{a8 as e,U as r,a as t,bo as n,k as o,L as i}from"../main.js";import{e as s,i as c,p as u}from"./aaBoundingBox-56c013d2.js";import{n as a}from"./ItemCache-710ba6c9.js";const l=s(-.5,-.5,-.5,.5,.5,.5),f=s(-.5,-.5,0,.5,.5,1),y=s(-.5,-.5,0,.5,.5,.5);function m(e){switch(e){case"sphere":case"cube":case"diamond":return l;case"cylinder":case"cone":case"inverted-cone":return f;case"tetrahedron":return y;default:return}}let h=p();function p(){return new a(50)}function d(){h=p()}function b(e,r){if("icon"===e.type)return v(e,r);if("object"===e.type)return z(e,r);throw new o("symbol3d:unsupported-symbol-layer","computeLayerSize only works with symbol layers of type Icon and Object")}async function w(r,t){if("icon"===r.type)return function(e,r){return v(e,r).then((r=>{if(null==e.size)return r;const t=r[0]/r[1];return t>1?[e.size,e.size/t]:[e.size*t,e.size]}))}(r,t);if("object"===r.type)return async function(r,t){return function(r,{isPrimitive:t,width:n,depth:o,height:i}){const s=t?10:1;if(null==n&&null==i&&null==o)return[s*r[0],s*r[1],s*r[2]];const c=e(n,o,i);let u;for(let e=0;e<3;e++){const t=c[e];if(null!=t){u=t/r[e];break}}for(let e=0;e<3;e++)null==c[e]&&(c[e]=r[e]*u);return c}(await z(r,t),r)}(r,t);throw new o("symbol3d:unsupported-symbol-layer","computeLayerSize only works with symbol layers of type Icon and Object")}async function v(e,r){if(e.resource.href)return(n=e.resource.href,i(n,{responseType:"image"}).then((e=>e.data))).then((e=>[e.width,e.height]));var n;if(e.resource.primitive)return t(r)?[r,r]:[256,256];throw new o("symbol3d:invalid-symbol-layer","symbol layers of type Icon must have either an href or a primitive resource")}function z(e,i){return async function(e,i){if(!e.isPrimitive){const t=e.resource.href,n=h.get(t);if(void 0!==n)return r(n);const o=await import("./objectResourceUtils-fc04fcc5.js").then((function(e){return e.o})),i=await o.fetch(t,{disableTextures:!0});return h.put(t,i.referenceBoundingBox),i.referenceBoundingBox}let s=null;if(e.resource&&e.resource.primitive&&(s=c(m(e.resource.primitive)),t(i)))for(let e=0;e<s.length;e++)s[e]*=i;return s?r(s):n(new o("symbol:invalid-resource","The symbol does not have a valid resource"))}(e,i).then((e=>u(e)))}export{d as clearBoundingBoxCache,v as computeIconLayerResourceSize,b as computeLayerResourceSize,w as computeLayerSize,z as computeObjectLayerResourceSize};
